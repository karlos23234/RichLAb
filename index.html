<!doctype html>
<html lang="hy">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BirdsGolden ‚Äî Demo (Frontend-only)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --accent-green: #10b981;
      --dark-900:#0f172a;
      --muted:#94a3b8;
    }

    body { background: linear-gradient(180deg,#0f172a 0%, #071026 100%); color:#e6eef8; font-family: Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial; }

    .card { background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); border: 1px solid rgba(255,255,255,0.04); border-radius: 14px; padding: 18px; }
    .glass { backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); }

    /* Big green pulse for success */
    .big-green-pulse { animation: bigGreenPulse 1.2s ease-out; }
    @keyframes bigGreenPulse {
      0% { transform: scale(1); box-shadow: 0 0 0 rgba(16,185,129,0); }
      30% { transform: scale(1.06); box-shadow: 0 0 40px rgba(16,185,129,0.45); }
      60% { transform: scale(1.02); box-shadow: 0 0 30px rgba(16,185,129,0.35); }
      100% { transform: scale(1); box-shadow: 0 0 0 rgba(16,185,129,0); }
    }

    /* subtle gray spot */
    .big-gray-spot { animation: bigGraySpot 1.0s ease-out; }
    @keyframes bigGraySpot {
      0% { transform: scale(1); box-shadow: 0 0 0 rgba(55,65,81,0); opacity: 0.95; }
      50% { transform: scale(1.03); box-shadow: 0 0 40px rgba(55,65,81,0.35); opacity: 1; }
      100% { transform: scale(1); box-shadow: 0 0 0 rgba(55,65,81,0); }
    }

    .progress-bg { background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); border-radius: 999px; height: 12px; }
    .progress-fill { height: 12px; border-radius: 999px; transition: width 700ms cubic-bezier(.2,.9,.2,1); }

    .muted { color: var(--muted); }
    .small { font-size: 12px; }

    /* modal */
    .modal-backdrop { position: fixed; inset: 0; display: none; align-items:center; justify-content:center; z-index:60; }
    .modal { max-width:520px; width:100%; margin: 0 16px; }

    /* user list */
    .user-chip { background: rgba(255,255,255,0.02); padding:8px 10px; border-radius:10px; cursor:pointer; border:1px solid rgba(255,255,255,0.02); }
    .user-chip.active { background: linear-gradient(90deg,#064e3b,#065f46); box-shadow: 0 6px 24px rgba(6,95,70,0.18); }
  </style>
</head>
<body class="min-h-screen flex items-start justify-center py-10 px-4">

  <div class="w-full max-w-5xl space-y-6">
    <header class="flex items-center justify-between">
      <div class="flex items-center space-x-4">
        <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-emerald-500 to-green-600 flex items-center justify-center shadow-lg text-black font-bold">BG</div>
        <div>
          <h1 class="text-2xl font-extrabold">BirdsGolden ‚Äî Demo (Frontend-only)</h1>
          <div class="small muted">’Ñ’´’ª’∏÷Å’°’Ø: client-side ÷Å’∏÷Ç÷Å’°’§÷Ä’æ’°’Æ ’¢’∏’¨’∏÷Ä users-’®’ù localStorage-’∏÷Ç’¥ (demo)</div>
        </div>
      </div>

      <div class="flex items-center space-x-3">
        <button id="btn-add-user" class="px-3 py-2 bg-slate-800/50 rounded-lg small">‘±’æ’•’¨’°÷Å’∂’•’¨ ÷Ö’£’ø’°’ø’•÷Ä</button>
        <button id="btn-reset-demo" class="px-3 py-2 bg-red-700/40 rounded-lg small">’ä —á–∏—Å—Ç–∏—Ç—å demo</button>
      </div>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Left: User list & actions -->
      <section class="card glass col-span-1">
        <h3 class="font-bold mb-3">’ï’£’ø’æ’∏’≤’∂’•÷Ä (local demo)</h3>
        <div id="users-list" class="space-y-2 mb-4"></div>

        <div class="mb-4">
          <label class="small muted">Active user</label>
          <div id="active-user" class="mt-2 p-3 rounded-lg bg-slate-900/30">‚Äînot selected‚Äî</div>
        </div>

        <div class="space-y-2">
          <button id="open-deposit" class="w-full px-4 py-2 bg-emerald-500 rounded-lg font-bold">‘±’æ’•’¨’°÷Å’∂’•’¨ ’§’•’∫’∏’¶’´’ø</button>
          <button id="open-withdraw" class="w-full px-4 py-2 bg-red-600 rounded-lg font-bold">‘µ’¨÷Ñ’°’£÷Ä’•’¨ ’£’∏÷Ç’¥’°÷Ä</button>
        </div>

        <div class="mt-4 small muted">URL Referral (’§’•’¥’∏): add <code>?r=&lt;refCode&gt;</code> ‚Äî stored as pending until first deposit ‚â•1,000</div>
      </section>

      <!-- Middle: Balance & requirements -->
      <section class="card glass col-span-1 lg:col-span-1">
        <div class="flex items-center justify-between mb-4">
          <div>
            <div class="small muted">’Ä’°’Ω’°÷Ä’°’Ø ’¥’∂’°÷Å’∏÷Ä’§</div>
            <div id="main-balance" class="text-3xl font-extrabold mt-1">÷è0</div>
            <div class="small muted">’Ä’°’∑’´’æ: <span id="main-username">‚Äî</span></div>
          </div>
          <div class="text-right">
            <div class="small muted">First deposit: <span id="first-deposit-status">‚Äî</span></div>
            <div class="small muted">Ref credited: <span id="ref-credited-status">‚Äî</span></div>
          </div>
        </div>

        <div class="mb-4">
          <div class="flex items-center justify-between mb-2">
            <div class="small muted">üí∞ ’Ñ’∂’°÷Å’∏÷Ä’§ (’£’∏’°’¨ ÷è125,000)</div>
            <div class="small muted" id="withdrawal-progress">0/125000</div>
          </div>
          <div class="progress-bg">
            <div id="withdrawal-bar" class="progress-fill" style="width:0%; background: linear-gradient(90deg,var(--accent-green), #059669);"></div>
          </div>
        </div>

        <div>
          <div class="flex items-center justify-between mb-2">
            <div class="small muted">üìÖ ‘±’∑’≠. ÷Ö÷Ä’•÷Ä (’£’∏’°’¨ 15)</div>
            <div class="small muted" id="work-days-progress">0/15</div>
          </div>
          <div class="progress-bg">
            <div id="work-days-bar" class="progress-fill" style="width:0%; background: linear-gradient(90deg,#7c3aed,#4f46e5);"></div>
          </div>
        </div>

        <div class="mt-4 flex space-x-2">
          <button id="simulate-day" class="px-3 py-2 bg-slate-800/40 rounded small">’ç’´’¥’∏÷Ç’¨. ’°’∑’≠’°’ø’°’∂÷Ñ’°’µ’´’∂ ÷Ö÷Ä +1</button>
          <button id="simulate-ref" class="px-3 py-2 bg-yellow-500 rounded small">’ç’´’¥’∏÷Ç’¨. ’¢’∏’∂’∏÷Ç’Ω’´ ’Ω’ø’∏÷Ç’£’∏÷Ç’¥</button>
        </div>

        <div class="mt-4 small muted">
          ’Ü’∑’∏÷Ç’¥‚Ä§ ’•’¨÷Ñ’°’£÷Ä’¥’°’∂ ’Ø’∏’≥’°’Ø’® ’°’Ø’ø’´’æ’°’∂’∏÷Ç’¥ ’ß ’¥’´’°’µ’∂ ’•÷Ä’¢<br>
          <strong>1)</strong> ÷Ö’£’ø’æ’∏’≤’® ’°÷Ä’•’¨ ’ß ’∂’æ’°’¶. ’°’º’°’ª’´’∂ ’§’•’∫’∏’¶’´’ø ‚â•÷è1,000 ÷á <strong>2)</strong> ’∞’°’∑’æ’´’∂ ’°’º’Ø’° ’ß ‚â•÷è125,000 ÷á <strong>3)</strong> ’°’∑’≠’°’ø’°’∂÷Ñ’°’µ’´’∂ ÷Ö÷Ä’•÷Ä’® ‚â•15÷â
        </div>
      </section>

      <!-- Right: Activity & logs -->
      <section class="card glass col-span-1 lg:col-span-1">
        <h3 class="font-bold mb-3">‘≥’∏÷Ä’Æ’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä ÷á ÷Ö÷Ä’°’£’´÷Ä</h3>
        <div id="activity-log" class="h-64 overflow-auto small muted p-2 bg-slate-900/20 rounded"></div>
        <div class="mt-3 small muted">(Demo) Referral-credit ’©’∏÷Ç’µ’¨’°’ø÷Ä’æ’∏÷Ç’¥ ’ß ’¥’´’°’µ’∂ ’•÷Ä’¢ ’∂’∏÷Ä ÷Ö’£’ø’°’ø’•÷Ä’® ’Ø’°’ø’°÷Ä’´ ’´÷Ä ’°’º’°’ª’´’∂ ÷Ö÷Ä’´’∂’°’Ø’°’∂ ’§’•’∫’∏’¶’´’ø ÷è‚â•1,000 ‚Äî ’°’µ’§ ’∫’°’∞’´’∂ ’°’æ’ø’∏’¥’°’ø ’Ø’£÷Ä’°’∂÷Å’æ’•’∂ ’¢’∏’∂’∏÷Ç’Ω’∂’•÷Ä’®:</div>
      </section>
    </main>

    <footer class="mt-6 small muted text-center">Demo‚Ä§ ’°’º’°’∂÷Å backend. For production you must move logic server-side.</footer>
  </div>

  <!-- Deposit Modal -->
  <div id="modal-deposit-backdrop" class="modal-backdrop">
    <div class="modal card glass">
      <h3 class="font-bold text-xl mb-3">‘±’æ’•’¨’°÷Å’∂’•’¨ ’§’•’∫’∏’¶’´’ø (Demo)</h3>

      <div class="mb-3">
        <label class="small muted">‘≥’∏÷Ç’¥’°÷Ä’® (÷è)</label>
        <input id="input-deposit-amount" type="number" min="1000" step="100" class="w-full p-3 rounded bg-slate-900/40 border border-slate-800" placeholder="’Ñ’´’∂’´’¥’∏÷Ç’¥ 1000" />
      </div>

      <div class="mb-3 small muted">‘∏’∂’ø÷Ä’•÷Ñ ’¥’•’©’∏’§ (demo): Linen / USDT / DemoBank</div>
      <div class="flex space-x-2 mb-4">
        <button class="px-3 py-2 user-chip" data-method="linen">Linen</button>
        <button class="px-3 py-2 user-chip" data-method="usdt">USDT (TRC20)</button>
        <button class="px-3 py-2 user-chip" data-method="bank">Demo Bank</button>
      </div>

      <div class="flex space-x-2">
        <button id="deposit-do" class="px-4 py-2 bg-emerald-500 rounded font-bold disabled:opacity-50" disabled>‘±’æ’•’¨’°÷Å’∂’•’¨ (simulate)</button>
        <button id="deposit-cancel" class="px-4 py-2 bg-slate-800/40 rounded">’â’•’≤’°÷Ä’Ø’•’¨</button>
      </div>
    </div>
  </div>

  <!-- Withdraw Modal -->
  <div id="modal-withdraw-backdrop" class="modal-backdrop">
    <div class="modal card glass">
      <h3 class="font-bold text-xl mb-3">‘µ’¨÷Ñ’°’£÷Ä’•’¨ ’£’∏÷Ç’¥’°÷Ä</h3>

      <div class="mb-3">
        <div class="small muted">’Ä’°’Ω’°’∂’•’¨’´ ’¥’∂’°÷Å’∏÷Ä’§</div>
        <div id="withdraw-available-balance" class="text-2xl font-extrabold mt-1">÷è0</div>
      </div>

      <div class="mb-3">
        <label class="small muted">‘≥’∏÷Ç’¥’°÷Ä’® (÷è)</label>
        <input id="input-withdraw-amount" type="number" min="125000" step="5000" class="w-full p-3 rounded bg-slate-900/40 border border-slate-800" placeholder="’Ñ’´’∂’´’¥’∏÷Ç’¥ 125,000" />
      </div>

      <div id="withdraw-reason" class="mb-3 small muted">‘∏’∂’ø÷Ä’•÷Ñ ’•’¨÷Ñ’°’£÷Ä’¥’°’∂ ’•’≤’°’∂’°’Ø’®’ù EasyPay / Idram / Bank (demo)</div>

      <div class="flex space-x-2">
        <button id="withdraw-do" class="px-4 py-2 bg-red-600 rounded font-bold disabled:opacity-50" disabled>‘µ’¨÷Ñ’°’£÷Ä’•’¨</button>
        <button id="withdraw-cancel" class="px-4 py-2 bg-slate-800/40 rounded">’â’•’≤’°÷Ä’Ø’•’¨</button>
      </div>
    </div>
  </div>

<script>
/* ============================
   Demo frontend-only logic
   ============================ */

const STORAGE_KEY = 'bg_demo_users_v1';
const ACTIVITY_LIMIT = 200;
const REFERRAL_BONUS = 5000; // demo: give referrer this bonus when new user makes first deposit >=1000

// Utility: read URL ?r=ref
function getUrlReferral() {
  try {
    const p = new URLSearchParams(window.location.search);
    return p.get('r');
  } catch(e){ return null; }
}

// Load / Save users map (object: id -> user)
function loadUsers(){
  try{
    return JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
  }catch(e){ return {}; }
}
function saveUsers(users){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(users));
}

function logActivity(msg){
  const log = document.getElementById('activity-log');
  const time = new Date().toLocaleTimeString();
  log.insertAdjacentHTML('afterbegin', `<div class="mb-1">[${time}] ${msg}</div>`);
  // trim
  while(log.children.length > ACTIVITY_LIMIT) log.removeChild(log.lastChild);
}

/* Create a new demo user */
function createUser(username){
  const id = 'u'+Math.floor(Math.random()*900000 + 100000);
  const users = loadUsers();
  users[id] = {
    id, username: username || ('user_'+id.slice(-4)),
    balance: 0,
    workDays: 0,
    firstDepositMade: false,
    pending_ref: null,
    ref_credited: false,
    createdAt: Date.now()
  };

  // If URL has referral, attach it as pending_ref only if not set
  const r = getUrlReferral();
  if (r) {
    users[id].pending_ref = r;
    logActivity(`User ${users[id].username} created with pending referral r=${r}`);
  } else {
    logActivity(`User ${users[id].username} created`);
  }

  saveUsers(users);
  setActiveUser(id);
  renderUsers();
  return users[id];
}

/* Set active user (select) */
function setActiveUser(id){
  const users = loadUsers();
  if (!users[id]) return;
  localStorage.setItem('bg_demo_active', id);
  renderActiveUser();
  logActivity(`Active user set: ${users[id].username} (${id})`);
}

/* get active user object */
function getActiveUser(){
  const id = localStorage.getItem('bg_demo_active');
  if (!id) return null;
  const users = loadUsers();
  return users[id] || null;
}

/* update user and persist */
function updateUser(user){
  const users = loadUsers();
  users[user.id] = user;
  saveUsers(users);
  renderActiveUser();
  renderUsers();
}

/* render user list */
function renderUsers(){
  const cont = document.getElementById('users-list');
  cont.innerHTML = '';
  const users = loadUsers();
  const activeId = localStorage.getItem('bg_demo_active');
  Object.values(users).sort((a,b)=> b.createdAt - a.createdAt).forEach(u=>{
    const el = document.createElement('div');
    el.className = 'user-chip flex items-center justify-between';
    if (u.id === activeId) el.classList.add('active');
    el.innerHTML = `<div>
                      <div class="font-semibold">${escapeHtml(u.username)}</div>
                      <div class="small muted">÷è${Number(u.balance).toLocaleString()} ¬∑ days:${u.workDays} ¬∑ id:${u.id}</div>
                    </div>
                    <div class="flex flex-col items-end">
                      <button class="small px-2 py-1" data-action="select" data-id="${u.id}">Select</button>
                      <button class="small px-2 py-1 text-red-400" data-action="delete" data-id="${u.id}">X</button>
                    </div>`;
    cont.appendChild(el);
  });
}

/* render active user panel */
function renderActiveUser(){
  const au = getActiveUser();
  const el = document.getElementById('active-user');
  if (!au) {
    el.innerHTML = `<div class="muted small">‚Äî not selected ‚Äî</div>`;
    document.getElementById('main-balance').textContent = '÷è0';
    document.getElementById('main-username').textContent = '‚Äî';
    document.getElementById('withdraw-available-balance').textContent = '÷è0';
    document.getElementById('withdrawal-progress').textContent = '0/125000';
    document.getElementById('withdrawal-bar').style.width = '0%';
    document.getElementById('work-days-progress').textContent = '0/15';
    document.getElementById('work-days-bar').style.width = '0%';
    document.getElementById('first-deposit-status').textContent = '‚Äî';
    document.getElementById('ref-credited-status').textContent = '‚Äî';
    return;
  }
  el.innerHTML = `<div class="font-bold">${escapeHtml(au.username)}</div>
                  <div class="small muted">ID: ${au.id}</div>
                  <div class="mt-2 small muted">pending_ref: ${au.pending_ref || '‚Äî'}</div>`;
  document.getElementById('main-balance').textContent = `÷è${Number(au.balance).toLocaleString()}`;
  document.getElementById('main-username').textContent = au.username;
  document.getElementById('withdraw-available-balance').textContent = `÷è${Number(au.balance).toLocaleString()}`;

  document.getElementById('withdrawal-progress').textContent = `${Number(au.balance).toLocaleString()}/125000`;
  const balPercent = Math.min((au.firstDepositMade ? au.balance : 0) / 125000 * 100, 100);
  document.getElementById('withdrawal-bar').style.width = balPercent + '%';

  document.getElementById('work-days-progress').textContent = `${au.workDays}/15`;
  document.getElementById('work-days-bar').style.width = Math.min(au.workDays/15*100, 100) + '%';

  document.getElementById('first-deposit-status').textContent = au.firstDepositMade ? 'Yes' : 'No';
  document.getElementById('ref-credited-status').textContent = au.ref_credited ? 'Yes' : 'No';

  // Update deposit/withdraw buttons enabled state
  updateActionButtons();
}

/* update deposit & withdraw button availability */
function updateActionButtons(){
  const au = getActiveUser();
  const openDep = document.getElementById('open-deposit');
  const openW = document.getElementById('open-withdraw');

  if (!au) {
    openDep.disabled = true; openW.disabled = true; return;
  }
  openDep.disabled = false;

  // withdraw allowed only if firstDepositMade true AND balance >= 125000 AND workDays >= 15
  const canWithdraw = au.firstDepositMade && au.balance >= 125000 && au.workDays >= 15;
  openW.disabled = !canWithdraw;
}

/* === deposit flow (modal) === */
const modalDeposit = document.getElementById('modal-deposit-backdrop');
const inputDeposit = document.getElementById('input-deposit-amount');
const depositDo = document.getElementById('deposit-do');
let depositMethod = 'linen';

document.getElementById('open-deposit').addEventListener('click', ()=>{
  modalDeposit.style.display = 'flex';
  inputDeposit.value = '';
  depositDo.disabled = true;
});

document.getElementById('deposit-cancel').addEventListener('click', ()=> modalDeposit.style.display='none');

document.querySelectorAll('#modal-deposit-backdrop .user-chip').forEach(b=>{
  b.addEventListener('click', (e)=>{
    document.querySelectorAll('#modal-deposit-backdrop .user-chip').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    depositMethod = b.getAttribute('data-method');
  });
});

inputDeposit.addEventListener('input', ()=> {
  depositDo.disabled = !(Number(inputDeposit.value) >= 1000);
});

depositDo.addEventListener('click', ()=> {
  const amount = Number(inputDeposit.value);
  const au = getActiveUser();
  if (!au) { alert('‘∏’∂’ø÷Ä’•÷Ñ ÷Ö’£’ø’°’ø’´÷Ä’∏’ª’®÷â'); return; }
  if (isNaN(amount) || amount < 1000) { alert('’Ü’æ’°’¶’°’£’∏÷Ç’µ’∂’® ÷è1000'); return; }

  // Simulate payment: immediate success (demo). In prod: redirect to provider & webhook.
  const users = loadUsers();
  users[au.id].balance = Number(users[au.id].balance) + amount;

  // If first deposit >=1000 and not yet firstDepositMade -> mark and process pending_ref in server-like way
  if (!users[au.id].firstDepositMade && amount >= 1000) {
    users[au.id].firstDepositMade = true;
    // process pending_ref: find referrer by code (we treat pending_ref as refer's id)
    const pending = users[au.id].pending_ref;
    if (pending && users[pending] && !users[au.id].ref_credited) {
      // credit referrer
      users[pending].balance = Number(users[pending].balance) + REFERRAL_BONUS;
      users[au.id].ref_credited = true;
      logActivity(`Referral: ${users[pending].username} credited ÷è${REFERRAL_BONUS} because ${users[au.id].username} made first deposit.`);
    }
  }
  saveUsers(users);
  modalDeposit.style.display='none';
  inputDeposit.value='';
  renderActiveUser();
  renderUsers();
  flashBalance();
  logActivity(`Deposit: ${au.username} +÷è${amount} via ${depositMethod}`);
});

/* withdraw modal */
const modalWithdraw = document.getElementById('modal-withdraw-backdrop');
document.getElementById('open-withdraw').addEventListener('click', ()=> modalWithdraw.style.display='flex');
document.getElementById('withdraw-cancel').addEventListener('click', ()=> modalWithdraw.style.display='none');

document.getElementById('input-withdraw-amount').addEventListener('input', function(){
  const val = Number(this.value);
  const au = getActiveUser();
  const btn = document.getElementById('withdraw-do');
  if (!au) { btn.disabled = true; return; }
  if (isNaN(val) || val <= 0 || val > au.balance) btn.disabled = true; else btn.disabled = false;
});

document.getElementById('withdraw-do').addEventListener('click', ()=>{
  const amt = Number(document.getElementById('input-withdraw-amount').value);
  const au = getActiveUser();
  if (!au) { alert('‘∏’∂’ø÷Ä’•÷Ñ ÷Ö’£’ø’°’ø’´÷Ä’∏’ª’®'); return; }
  if (amt > au.balance) { alert('’â’Ø’°÷Ä’∏’≤’°÷Å’°÷Ñ’ù ’∏’π ’¢’°’æ’°÷Ä’°÷Ä ’¥’∂’°÷Å’∏÷Ä’§'); return; }

  // Withdrawal request simulated -> subtract balance
  const users = loadUsers();
  users[au.id].balance = Number(users[au.id].balance) - amt;
  saveUsers(users);
  renderActiveUser();
  renderUsers();
  modalWithdraw.style.display='none';
  logActivity(`Withdraw request: ${au.username} -÷è${amt}`);
});

/* simulate day & other actions */
document.getElementById('simulate-day').addEventListener('click', ()=>{
  const au = getActiveUser();
  if (!au) { alert('‘∏’∂’ø÷Ä’•÷Ñ ÷Ö’£’ø’°’ø’•÷Ä'); return; }
  const users = loadUsers();
  users[au.id].workDays = (users[au.id].workDays || 0) + 1;
  saveUsers(users);
  renderActiveUser();
  logActivity(`Simulate day: ${au.username} workDays -> ${users[au.id].workDays}`);
});

document.getElementById('simulate-ref').addEventListener('click', ()=>{
  alert('Demo: referral credits are applied automatically when a new user with pending_ref makes first deposit ‚â•1000.');
});

/* add user button */
document.getElementById('btn-add-user').addEventListener('click', ()=>{
  const name = prompt('’Ñ’∏÷Ç’ø÷Ñ’°’£÷Ä’´÷Ä ÷Ö’£’ø’°’∂’∏÷Ç ’°’∂’∏÷Ç’∂’® (demo):') || '';
  createUser(name.trim() || undefined);
});

/* reset demo */
document.getElementById('btn-reset-demo').addEventListener('click', ()=>{
  if (!confirm('’Ñ’•’Æ ’©’∏÷Ç’µ’¨’ø’æ’∏÷Ç’©’µ’∏÷Ç’∂ ‚Äî ’¶÷Ä’∏’û’¥ local demo ’ø’æ’µ’°’¨’∂’•÷Ä’®÷â')) return;
  localStorage.removeItem(STORAGE_KEY);
  localStorage.removeItem('bg_demo_active');
  renderUsers();
  renderActiveUser();
  logActivity('Demo reset');
});

/* users-list actions (delegate) */
document.getElementById('users-list').addEventListener('click', (e)=>{
  const btn = e.target.closest('button');
  if (!btn) return;
  const action = btn.getAttribute('data-action');
  const id = btn.getAttribute('data-id');
  if (action === 'select') setActiveUser(id);
  if (action === 'delete') {
    if (!confirm('’ã’∂’ª’•’û’¨ user-’® local demo-’´÷Å÷â')) return;
    const users = loadUsers();
    if (users[id]) {
      delete users[id];
      saveUsers(users);
      if (localStorage.getItem('bg_demo_active') === id) localStorage.removeItem('bg_demo_active');
      renderUsers(); renderActiveUser();
      logActivity(`User ${id} deleted (demo)`);
    }
  }
});

/* initial render */
(function init(){
  // if no users exist, create one demo user
  const users = loadUsers();
  if (Object.keys(users).length === 0) {
    createUser('Armen_demo');
    createUser('Referrer_demo'); // second user to test referral
    // set referrer_demo id into URL param of new user manually for testing if desired
  }
  renderUsers();

  // if no active user set, pick first
  if (!localStorage.getItem('bg_demo_active')) {
    const keys = Object.keys(loadUsers());
    if (keys.length) setActiveUser(keys[0]);
  }
  renderActiveUser();

  // If URL contains ?r=REFID and active user doesn't have pending_ref, attach to active user
  const refFromUrl = getUrlReferral();
  if (refFromUrl) {
    const au = getActiveUser();
    if (au && !au.pending_ref) {
      au.pending_ref = refFromUrl;
      updateUser(au);
      logActivity(`Attached pending_ref=${refFromUrl} to active user ${au.username}`);
      // remove param from URL to prevent re-using (UX)
      const url = new URL(window.location);
      url.searchParams.delete('r');
      window.history.replaceState({}, '', url);
    }
  }

  // small UI: make deposit modal buttons clickable style
  document.querySelectorAll('#modal-deposit-backdrop .user-chip').forEach(x=>{
    x.addEventListener('click', ()=> {
      document.querySelectorAll('#modal-deposit-backdrop .user-chip').forEach(y=>y.classList.remove('active'));
      x.classList.add('active');
    });
  });

})();

/* small helpers */
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, (m)=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]); }

function flashBalance(){
  const el = document.getElementById('main-balance');
  el.classList.add('big-green-pulse');
  setTimeout(()=> el.classList.remove('big-green-pulse'), 1400);
}

// small initial activity
logActivity('Demo initialized ‚Äî client-side only.');

</script>
</body>
</html>




